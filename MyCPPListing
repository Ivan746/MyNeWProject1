#include "stdafx.h"
#include <iostream>
#include <cstdio>
#include <conio.h>
#include <cstring>

void MagStr (char *str)
{

	int i, j;
	int flag = 0;

	int strlen_str = strlen(str);


	for(i = 0, j = 0; i < strlen_str; i++){
		if((str[i] != ' ') && (str[i] != '\t') && (flag == 0)){
			str[j] = str[i];
			j++;
			flag = 1;
			continue;
		}
		if(((str[i] != ' ') && (str[i] != '\t')) && ((str[i - 1] != ' ') && (str[i - 1] != '\t'))){
			str[j] = str[i];
			j++;
			continue;
		}
		if(((str[i] != ' ') && (str[i] != '\t')) && ((str[i - 1] == ' ') || (str[i - 1] == '\t'))){
			str[j] = ' ';
			str[j + 1] = str[i];
			j += 2;
			continue;
		}
	}
	str[j] = '\0';
}

void Bias(char *str, int count_str, int *x, int *y)
{
	char West[]  = "Запад";
	char East[]  = "Восток";
	char North[] = "Север";
	char South[] = "Юг";
	
	int Strlen_Str = strlen(str);

	if (Strlen_Str >= 3){
		int space = ' ';
		int i, j;

		char *adr_space = NULL;

		adr_space = strchr(str, space);

		if(adr_space != NULL){

			int Numb_simv = adr_space - str;
			int Strlen_substr = Strlen_Str - Numb_simv;
		
			int flag = 0;

			char *str2 = (char*) malloc(sizeof(char) * Strlen_substr);

			for(i = Numb_simv, j = 0; i < Strlen_Str; i++){
			 str2[j] = str[i];
			 j++;
			}

			if (!strncmp(North, str, Numb_simv)){
				*y += atoi(str2);
			} else {

				if (!strncmp(South, str, Numb_simv)){
					*y -= atoi(str2);
				} else {

					if (!strncmp(East, str, Numb_simv)){
						*x += atoi(str2);
					} else {

						if (!strncmp(West, str, Numb_simv)){
							*x -= atoi(str2);
						} else {
							printf("Cтрока № %i не совпадает ни с 1 из сторон света\n", count_str);
						}
					}
				}
			}
			free(str2);
		} else {
			 printf("Cтрока № %i состоит из 1 слова\n", count_str);
		}
	} else {
	    printf("Cтрока № %i пустая\n", count_str);
	}
}

int _tmain(int argc, _TCHAR* argv[])
{
	setlocale(LC_CTYPE,"Russian_Russia.1251");

	if (argc > 1){	
	} else {
		printf("Файл с координатами не получен\n");
	}

	int Kord[2] = {0,0}; 
	
	FILE *file;
	char File_Name[] = "Koords.txt";
	file = fopen(argv[1], "r");
	
	if(!file){
		printf("Ошибка открытия файла %s", argv[1]);
	} 

	fseek(file, 0, SEEK_END);
	int Numb_Elem_File = ftell(file);
	rewind(file);

	char *buffer = (char*) malloc(sizeof(char) * Numb_Elem_File);
	
	int count_str = 0;

	while(!feof(file)){
		fgets(buffer, Numb_Elem_File, file);
		MagStr(buffer);
		Bias(buffer, count_str, &Kord[0], &Kord[1]);
		count_str++;
	}

	printf("Финальная координата = %i %c %i \n", Kord[0], ',', Kord[1]);

	free(buffer);
	system("pause");
}
